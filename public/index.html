<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FORTUNA PLAY‚Ñ¢</title>

<meta property="og:title" content="FORTUNA PLAY‚Ñ¢ - üé°Gira la RUEDA DE LA FORTUNA y gana premiosüéÅüéâ">
<meta property="og:description" content="Gira la Rueda de la Fortuna cada 24 hs y gana premios incre√≠bles.">
<meta property="og:image" content="https://iili.io/KfQm7dF.md.jpg">
<meta property="og:url" content="https://tudominio.com/rueda.html">
<meta property="og:type" content="website">
<meta property="og:site_name" content="FORTUNA PLAY‚Ñ¢">

<style>
body { margin:0; font-family: Arial Black, sans-serif; text-align:center; color:#0ff;
       background:url('https://iili.io/KCkmp4I.md.webp') no-repeat center center fixed;
       background-size:cover; text-shadow:0 0 5px #000,0 0 8px #000; }
.logo-container { display:flex; justify-content:center; align-items:center; flex-direction:column; margin:5px 0; width:100%; }
#logoTop, #finalImage { max-width:45%; width:100%; height:auto; display:block; margin:0 auto 5px auto; filter:drop-shadow(0 0 10px #0ff); animation: neonLogo 2s infinite alternate; }
@keyframes neonLogo { 0%{filter:drop-shadow(0 0 10px #0ff);} 25%{filter:drop-shadow(0 0 15px #f0f);} 50%{filter:drop-shadow(0 0 10px #ff0);} 75%{filter:drop-shadow(0 0 15px #0f0);} 100%{filter:drop-shadow(0 0 10px #0ff);} }
.textos-superiores { text-align:center; font-size:clamp(1rem,2.5vw,1.3rem); font-weight:bold; line-height:1.6; margin:10px 0 15px 0; color:#0ff; text-shadow:0 0 5px #000,0 0 8px #000; }
#wheelContainer { position:relative; width:90vw; max-width:340px; margin:0 auto 5px auto; }
#wheelCanvas { width:100%; height:auto; }
#arrow { position:absolute; top:-10px; left:50%; transform:translateX(-50%); width:6px; height:35px; background:#fff; border-radius:2px; z-index:10; }
button { margin:5px 0; padding:12px 30px; font-size:clamp(1rem,2vw,1.2rem); border:none; border-radius:50px; cursor:pointer; transition:.3s; }
#spinButton { background:#ff0; color:#4b0082; font-weight:bold; box-shadow:0 0 10px #000; }
#winnerButton { margin-top:10px; padding:12px 25px; font-size:clamp(1rem,2vw,1.2rem); border-radius:50px; background:#25D366; color:#fff; cursor:pointer; border:none; }
#winnerButton:hover { transform:scale(1.08); }
#winnerPopup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0); background:rgba(0,0,0,0.95);
               padding:clamp(15px,4vw,25px); border-radius:20px; color:#0ff; font-size:clamp(1rem,3vw,1.4rem);
               text-align:center; z-index:1000; width:90%; max-width:400px; max-height:80vh; overflow-y:auto;
               border:3px solid #0ff; box-shadow:0 0 20px #0ff,0 0 40px #0ff,0 0 60px #0ff; transition:.4s; }
#winnerPopup.show { transform:translate(-50%,-50%) scale(1); }
#dailyCounter { margin-top:3px; font-size:clamp(0.8rem,2vw,0.95rem); color:#0ff; text-shadow:0 0 5px #000,0 0 8px #000; }
@media(max-width:600px){#logoTop{max-width:60%;}#wheelContainer{width:85vw;}button{padding:10px 20px;}}
</style>
</head>
<body>

<div class="logo-container">
  <img id="logoTop" src="https://iili.io/KfLSxhG.md.webp" alt="Logo FORTUNA PLAY">
</div>

<div class="textos-superiores">
  üéÅ GIRA CADA 24 HS Y GANA üéÅ <br>
  üôå INVITA A TUS AMIGOS üôå <br>
  üì∏ RECORD√Å SACARLE CAPTURA A LOS PREMIOS üì∏
</div>

<div id="wheelContainer">
  <!-- ‚úÖ El ID de este canvas es clave -->
  <canvas id="wheelCanvas" width="340" height="340"></canvas>
  <div id="arrow"></div>
</div>

<button id="spinButton">GIRAR</button>
<div id="dailyCounter"></div>

<div id="winnerPopup">
  <div id="winnerMessage"></div>
  <div id="winnerDate"></div>
  <div id="winnerNote">¬°S√ÅCALE CAPTURA PARA RECLAMAR TU PREMIO!</div>
  <button id="winnerButton">Solicitar premio</button>
</div>

<div class="logo-container">
  <img id="finalImage" src="https://iili.io/KK0OCrl.md.png" alt="Imagen final">
</div>

<div id="legal">+18 | Juego Responsable</div>

<!-- ‚úÖ Script al final para que el DOM ya exista -->
<script>
document.addEventListener("DOMContentLoaded", function(){

  function getUserId() {
    let uid = localStorage.getItem("ruleta_uid");
    if (!uid) {
      uid = "u_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
      localStorage.setItem("ruleta_uid", uid);
    }
    return uid;
  }

  const spinBtn = document.getElementById('spinButton');
  const popup   = document.getElementById('winnerPopup');
  const winnerMsg  = document.getElementById('winnerMessage');
  const winnerDate = document.getElementById('winnerDate');
  const winnerBtn  = document.getElementById('winnerButton');
  const dailyCounter = document.getElementById('dailyCounter');

  const canvas = document.getElementById('wheelCanvas');
  const ctx = canvas.getContext('2d');
  const segments = 7;
  const anglePer = (2 * Math.PI) / segments;
  const colors = ["#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500"];
  let currentAngle = 0;

  function drawWheel(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<segments;i++){
      ctx.beginPath();
      ctx.moveTo(170,170);
      ctx.arc(170,170,170,currentAngle+i*anglePer,currentAngle+(i+1)*anglePer);
      ctx.closePath();
      ctx.fillStyle = colors[i%colors.length];
      ctx.fill();
      ctx.strokeStyle="#000";
      ctx.stroke();
    }
  }
  drawWheel();

  function spinWheel(callback){
    const spins = 5 + Math.random()*3;
    const endAngle = (2*Math.PI)*spins;
    let start = null;
    function animate(ts){
      if(!start) start = ts;
      const progress = (ts-start)/3500;
      if(progress<1){
        currentAngle = endAngle * (1 - Math.pow(1 - progress, 3));
        drawWheel();
        requestAnimationFrame(animate);
      } else {
        drawWheel();
        callback();
      }
    }
    requestAnimationFrame(animate);
  }

  function showPopup(msg,date,cajero){
    winnerMsg.textContent  = msg;
    winnerDate.textContent = date ? `Fecha: ${date}` : '';
    popup.classList.add('show');
    if(cajero){
      winnerBtn.onclick = () => {
        const texto = encodeURIComponent(
          `Hola ${cajero.nombre}! Gan√© ${msg} el ${date} y quisiera reclamarlo.`
        );
        window.open(`https://wa.me/54${cajero.numero}?text=${texto}`, '_blank');
      };
    } else {
      winnerBtn.onclick = null;
    }
  }

  function startCounter(msLeft){
    const timer = setInterval(()=>{
      if(msLeft <=0){ clearInterval(timer); dailyCounter.textContent=''; return; }
      const h = Math.floor(msLeft/3600000);
      const m = Math.floor((msLeft%3600000)/60000);
      dailyCounter.textContent = `Siguiente giro en: ${h}h ${m}m`;
      msLeft -= 60000;
    },60000);
  }

  spinBtn.addEventListener('click', ()=>{
    spinBtn.disabled = true;
    spinWheel(()=>{
      fetch('/girar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ usuarioId: getUserId() })
      })
      .then(r => r.json())
      .then(data => {
        if (data.yaGiro) {
          showPopup(data.mensaje,null,null);
        } else {
          showPopup(`Ganaste üéâ ${data.premio} üéâ`,
                    new Date().toLocaleString(),
                    data.cajero);
        }
      })
      .catch(()=> showPopup('Error de conexi√≥n',null,null))
      .finally(()=> spinBtn.disabled = false);
    });
  });

});
</script>
</body>
</html>
