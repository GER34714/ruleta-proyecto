<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FORTUNA PLAY‚Ñ¢</title>

<meta property="og:title" content="FORTUNA PLAY‚Ñ¢ - üé°Gira la RUEDA DE LA FORTUNA y gana premiosüéÅüéâ">
<meta property="og:description" content="Gira la Rueda de la Fortuna cada 24 hs y gana premios incre√≠bles. Invita a tus amigos y multiplica la diversi√≥n.">
<meta property="og:image" content="https://iili.io/KfQm7dF.md.jpg">
<meta property="og:url" content="https://tudominio.com/rueda.html">
<meta property="og:type" content="website">
<meta property="og:site_name" content="FORTUNA PLAY‚Ñ¢">

<style>
body {
  margin:0;
  font-family: Arial Black, sans-serif;
  text-align:center;
  color:#0ff;
  background:url('https://iili.io/KCkmp4I.md.webp') no-repeat center center fixed;
  background-size:cover;
  text-shadow:0 0 5px #000,0 0 8px #000;
}
/* Overlay para resaltar */
body::before {
  content:"";
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.35);
  pointer-events:none;
}

.logo-container {
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  margin:5px 0;
  width:100%;
}
#logoTop, #finalImage {
  max-width:45%;
  width:100%;
  height:auto;
  display:block;
  margin:0 auto 5px auto;
  filter:drop-shadow(0 0 10px #0ff);
  animation: neonLogo 2s infinite alternate;
}
@keyframes neonLogo {
  0%{filter:drop-shadow(0 0 10px #0ff);}
  25%{filter:drop-shadow(0 0 15px #f0f);}
  50%{filter:drop-shadow(0 0 10px #ff0);}
  75%{filter:drop-shadow(0 0 15px #0f0);}
  100%{filter:drop-shadow(0 0 10px #0ff);}
}

.textos-superiores {
  text-align:center;
  font-size:clamp(1rem,2.5vw,1.3rem);
  font-weight:bold;
  line-height:1.6;
  margin:10px 0 15px 0;
  color:#0ff;
  text-shadow:0 0 5px #000,0 0 8px #000;
}

#wheelContainer {
  position:relative;
  width:90vw;
  max-width:340px;
  margin:0 auto 5px auto;
}
#wheelCanvas {
  width:100%;
  height:auto;
  box-shadow:0 0 25px rgba(0,255,255,0.7),
             0 0 50px rgba(0,255,255,0.5);
  border-radius:50%;
}
#arrow {
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%);
  width:6px;
  height:35px;
  background:#fff;
  border-radius:2px;
  z-index:10;
}

button {
  margin:5px 0;
  padding:12px 30px;
  font-size:clamp(1rem,2vw,1.2rem);
  border:none;
  border-radius:50px;
  cursor:pointer;
  transition:.3s;
}
#spinButton {
  background:linear-gradient(45deg,#ffe600,#ffb300);
  color:#4b0082;
  font-weight:bold;
  box-shadow:0 0 15px #ff0;
}
#spinButton:hover {
  transform:scale(1.08);
  box-shadow:0 0 25px #fff000;
}

#winnerButton {
  margin-top:10px;
  padding:12px 25px;
  font-size:clamp(1rem,2vw,1.2rem);
  border-radius:50px;
  background:#25D366;
  color:#fff;
  cursor:pointer;
  border:none;
}
#winnerButton:hover { transform:scale(1.08); }

#winnerPopup {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(0);
  background:rgba(0,0,0,0.95);
  padding:clamp(15px,4vw,25px);
  border-radius:20px;
  color:#0ff;
  font-size:clamp(1rem,3vw,1.4rem);
  text-align:center;
  z-index:1000;
  width:90%;
  max-width:400px;
  max-height:80vh;
  overflow-y:auto;
  border:3px solid #0ff;
  box-shadow:0 0 20px #0ff,0 0 40px #0ff,0 0 60px #0ff;
}
#winnerPopup.show { transform:translate(-50%,-50%) scale(1); }

#winnerMessage,#winnerDate,#winnerNote,#winnerReturn { margin:5px 0; }
#winnerNote { font-weight:bold; color:#0ff; }
#winnerReturn { font-weight:bold; color:#0ff; font-size:clamp(1rem,2.5vw,1.2rem); }

#legal,#rights {
  font-size:clamp(0.7rem,2vw,0.9rem);
  margin:2px 0;
  color:#0ff;
  text-shadow:0 0 5px #000,0 0 8px #000;
}
#dailyCounter {
  margin-top:3px;
  font-size:clamp(0.8rem,2vw,0.95rem);
  color:#0ff;
  text-shadow:0 0 5px #000,0 0 8px #000;
}
@media(max-width:600px){
  #logoTop{max-width:60%;}
  #wheelContainer{width:85vw;}
  button{padding:10px 20px;}
}
</style>
</head>
<body>

<div class="logo-container">
  <img id="logoTop" src="https://iili.io/KfLSxhG.md.webp" alt="Logo FORTUNA PLAY">
</div>

<div class="textos-superiores">
  üéÅ GIRA CADA 24 HS Y GANA üéÅ <br>
  üôå INVITA A TUS AMIGOS üôå <br>
  üì∏ RECORD√Å SACARLE CAPTURA A LOS PREMIOS üì∏
</div>

<div id="wheelContainer">
  <canvas id="wheelCanvas" width="340" height="340"></canvas>
  <div id="arrow"></div>
</div>

<button id="spinButton">GIRAR</button>
<div id="dailyCounter"></div>

<div id="winnerPopup">
  <div id="winnerMessage"></div>
  <div id="winnerDate"></div>
  <div id="winnerNote">¬°S√ÅCALE CAPTURA A ESTA PANTALLA PARA RECLAMAR TU PREMIO!</div>
  <div id="winnerReturn">Volv√© ma√±ana a la misma hora para reclamar otro premio</div>
  <button id="winnerButton">Solicitar premio</button>
</div>

<div class="logo-container">
  <img id="finalImage" src="https://iili.io/KK0OCrl.md.png" alt="Imagen final">
</div>

<div id="legal">+18 | Juego Responsable | Apuesta con moderaci√≥n</div>
<div id="rights">Todos los derechos reservados FORTUNA PLAY‚Ñ¢</div>

<script>
// Colores ne√≥n de la rueda
const colors = ["#ff0099","#ffcc00","#33ff00","#00ffff","#0066ff","#cc00ff","#ff6600"];
const size = 7; // igual a cantidad de premios que defina el backend
const angleStep = (2*Math.PI)/size;
let currentAngle = 0;

// Generar o recuperar ID √∫nico de usuario
function getUserId() {
  let uid = localStorage.getItem("ruleta_uid");
  if (!uid) {
    uid = "u_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
    localStorage.setItem("ruleta_uid", uid);
  }
  return uid;
}

const spinBtn = document.getElementById('spinButton');
const popup = document.getElementById('winnerPopup');
const winnerMsg = document.getElementById('winnerMessage');
const winnerDate = document.getElementById('winnerDate');
const winnerBtn = document.getElementById('winnerButton');
const dailyCounter = document.getElementById('dailyCounter');
const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d');

// Dibuja la rueda
function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<size;i++){
    ctx.beginPath();
    ctx.moveTo(170,170);
    ctx.arc(170,170,170,currentAngle+i*angleStep,currentAngle+(i+1)*angleStep);
    ctx.closePath();
    ctx.fillStyle = colors[i%colors.length];
    ctx.fill();
    ctx.strokeStyle="#000";
    ctx.stroke();
  }
}
drawWheel();

// Gira con animaci√≥n
function spinWheel(finalIndex, callback){
  const spins = 5 + Math.random()*3;
  const endAngle = (2*Math.PI)*spins + finalIndex*angleStep + angleStep/2;
  let start = null;
  function animate(timestamp){
    if(!start) start = timestamp;
    const progress = (timestamp-start)/3500;
    if(progress<1){
      currentAngle = endAngle*easeOutCubic(progress);
      drawWheel();
      requestAnimationFrame(animate);
    } else{
      currentAngle = endAngle;
      drawWheel();
      if(callback) callback();
    }
  }
  requestAnimationFrame(animate);
}
function easeOutCubic(t){ return (--t)*t*t+1; }

// Contador regresivo
function updateCounter(msLeft){
  const interval = setInterval(()=>{
    if(msLeft <=0){ dailyCounter.textContent=''; spinBtn.disabled=false; clearInterval(interval); popup.classList.remove('show'); return; }
    const hours = Math.floor(msLeft/(1000*60*60));
    const minutes = Math.floor((msLeft%(1000*60*60))/(1000*60));
    const seconds = Math.floor((msLeft%(1000*60))/1000);
    dailyCounter.textContent = `Siguiente giro en: ${hours}h ${minutes}m ${seconds}s`;
    msLeft -=1000;
  },1000);
}

// Click en GIRAR
spinBtn.addEventListener('click', ()=>{
  spinBtn.disabled = true;
  const usuarioId = getUserId();

  // Pido resultado real al backend
  fetch('/girar', {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ usuarioId })
  })
  .then(r => r.json())
  .then(data => {
    if (data.yaGiro) {
      // Si ya gir√≥, muestro solo countdown
      winnerMsg.textContent = data.mensaje;
      winnerDate.textContent = "";
      popup.classList.add('show');
      spinBtn.disabled = true;
      // Aproximar ms que faltan (no viene exacto, pero suficiente)
      const h = parseInt(data.mensaje.match(/(\d+)h/)?.[1]||0);
      const m = parseInt(data.mensaje.match(/(\d+)m/)?.[1]||0);
      updateCounter((h*60+m)*60*1000);
    } else {
      // Calcular √≠ndice de premio para la animaci√≥n
      const premios = [
        "10% extra (en mi primera carga)",
        "15% extra (en mi primera carga)",
        "20% extra (en mi primera carga)",
        "30% extra (en mi segunda carga)",
        "100 fichas (sin carga, no retirables)",
        "500 fichas (sin carga, no retirables)",
        "300 fichas (sin carga, no retirables)"
      ];
      const prizeIndex = premios.indexOf(data.premio);
      spinWheel(prizeIndex, ()=>{
        winnerMsg.textContent = `Ganasteüéâ ${data.premio} üéâ`;
        winnerDate.textContent = `Contact√° a: ${data.cajero.nombre}`;
        popup.classList.add('show');
        winnerBtn.onclick = ()=>{
          const msg = encodeURIComponent(
            `Hola ${data.cajero.nombre}! Gan√© ${data.premio} y quisiera reclamarlo.`
          );
          window.open(`https://wa.me/54${data.cajero.numero}?text=${msg}`,'_blank');
        };
        updateCounter(24*60*60*1000);
      });
    }
  })
  .catch(()=> {
    winnerMsg.textContent = "Hubo un error. Prob√° de nuevo.";
    winnerDate.textContent = "";
    popup.classList.add('show');
    spinBtn.disabled = false;
  });
});
</script>
</body>
</html>
